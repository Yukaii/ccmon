# ccmon Domain Glossary

This glossary defines terms and concepts used in the ccmon project to ensure consistent terminology and make domain concepts clear to all contributors and users.

## Core Entities

| Term | Definition |
|------|------------|
| APIRequest | A domain entity representing a single Claude Code API request with session ID, timestamp, model, token usage, cost, and duration. Forms the core of the telemetry data collected from Claude Code interactions. |
| Token | A value object representing token usage for an API request, containing input tokens, output tokens, cache read tokens, and cache creation tokens. Provides methods for calculating totals and limited tokens. |
| Cost | A value object representing monetary cost in USD for API requests. Immutable with operations returning new instances. |
| Model | A value object identifying the AI model used (e.g., "claude-3-haiku", "claude-3-sonnet"). Distinguishes between base models (Haiku) and premium models (Sonnet/Opus) for billing and limit purposes. |
| Period | A value object representing a time range with start and end times. Used for filtering API requests and calculating statistics over specific timeframes. |
| Stats | An aggregate entity containing usage statistics for both base and premium models within a specific period, including request counts, token usage, costs, and burn rate calculations. |
| Usage | An entity representing usage statistics grouped by periods, typically used for daily usage displays and historical analysis. |
| Block | A value object representing Claude's 5-hour token limit blocks with start time and optional token limit. Used for monitoring usage against subscription plan limits. |
| Plan | A domain entity representing Claude subscription plans with name and monthly price. Supports plan types: unset (no plan), pro ($20), max ($200), max20 ($2000). Used for calculating usage percentages against plan limits. |
| UsageVariable | A domain entity representing predefined variables for quick query formatting. Contains a human-readable name and key for format string substitution (e.g., "@daily_cost"). |
| Entity ID | Unique identifier for APIRequest entities, generated by combining timestamp (RFC3339Nano format) and session ID, ensuring uniqueness across time and sessions. |
| Business Logic Encapsulation | Domain-driven design pattern where entities contain their own business methods (e.g., APIRequest.ID(), Stats.NewStatsFromRequests()), achieving better separation of concerns. |

## Business Concepts

| Term | Definition |
|------|------------|
| Base Models | Free AI models (currently Haiku) that don't count against Claude's token limits. Identified by checking if the model name contains "haiku" (case-insensitive). |
| Premium Models | Paid AI models (Sonnet, Opus, etc.) that count against Claude's token limits and subscription quotas. All models except Haiku are considered premium. |
| Token Limits | Claude subscription plans impose limits on premium token usage within 5-hour blocks: Pro (7,000), Max (35,000), Max20 (140,000) tokens per block. |
| Limited Tokens | Only input and output tokens count against Claude's rate limits. Cache tokens (read/creation) are excluded from limit calculations. |
| Burn Rate | The rate of premium token consumption per minute, calculated as limited tokens divided by period duration. Used to monitor API usage intensity. |
| Block Tracking | Monitoring API usage within Claude's 5-hour token limit blocks, showing progress bars and time remaining until the next block starts. |
| Session ID | A unique identifier for a Claude Code session, used to group related API requests and track usage patterns. |
| Plan Usage Percentage | Calculated percentage showing how much of a subscription plan's monthly cost limit has been consumed by current usage. Computed as (actual cost / plan price) * 100. |
| Quick Query | Command-line feature enabling instant retrieval of usage statistics without launching the full TUI, using format strings with predefined variables. |
| Format Variables | Predefined placeholders (@daily_cost, @monthly_cost, @daily_plan_usage, @monthly_plan_usage) that can be used in format strings for quick queries. |

## Technical Concepts

| Term | Definition |
|------|------------|
| OTLP | OpenTelemetry Protocol used by Claude Code to send usage data to ccmon via log records with body "claude_code.api_request". |
| gRPC Query Service | Service providing read-only access to stored telemetry data via Protocol Buffers interface, enabling multiple monitors to connect to a single server. |
| TUI | Terminal User Interface - the interactive terminal-based dashboard that displays real-time statistics with keyboard navigation and multiple views. |
| Server Mode | Headless operation mode running the OTLP collector and gRPC query service to receive and store telemetry data. |
| Monitor Mode | Interactive TUI mode that connects to a server via gRPC to display usage statistics and request details. |
| Format Query Mode | Non-interactive command-line mode that outputs formatted usage data directly to stdout using the --format flag, suitable for scripting and automation. |
| TimePeriodFactory | Service layer component providing timezone-aware period creation for consistent time calculations across the application. Eliminates duplicate period logic. |
| Embedded Data | Pattern using Go's go:embed directive to compile JSON configuration files into the binary, eliminating runtime file dependencies while maintaining updateability. |

## Cache Concepts

| Term | Definition |
|------|------------|
| Cache Read Tokens | Tokens consumed when reading from Claude's prompt cache, typically at reduced cost compared to input tokens. |
| Cache Creation Tokens | Tokens used when creating entries in Claude's prompt cache, enabling faster subsequent requests with similar context. |
| Cache Tokens | Combined cache read and creation tokens that don't count against rate limits but contribute to total usage statistics. |
| StatsCache | Interface defining contract for caching calculated statistics with Get/Set operations, injected into CalculateStatsQuery for dependency inversion compliance. |
| InMemoryStatsCache | TTL-based in-memory cache implementation storing calculated statistics for improved query performance, featuring lazy cleanup and thread-safe concurrent access. |
| NoOpStatsCache | No-operation cache implementation that returns nil for all Get operations, used when caching is disabled or for testing scenarios. |
| TTL (Time To Live) | Cache expiration mechanism where cached statistics automatically expire after a configured duration (default 1 minute) to prevent stale data. |
| CachedStats | Internal cache structure containing an entity.Stats object and expiration timestamp, used by InMemoryStatsCache for TTL-based storage. |
| Cache-First Strategy | Query pattern where cache is checked before expensive repository operations, improving performance for frequently accessed statistics. |
| Lazy Cleanup | Memory management approach where expired cache entries are removed on-demand during Get/Set operations rather than using background goroutines. |

## Display and UI Concepts

| Term | Definition |
|------|------------|
| Daily Usage | Historical view showing usage statistics aggregated by day, typically covering the last 30 days with detailed token breakdowns. |
| Current View | Real-time dashboard showing recent API requests, current statistics, and optional block progress tracking. |
| Display Modes | Different table layouts: FullMode (9 columns), GroupedMode (4 main columns), CompactMode (4 simplified columns for narrow terminals). |
| Time Filtering | Ability to filter displayed requests by time periods (1 hour, 24 hours, all time) while maintaining separate statistics for display and block tracking. |

## Repository and Data Concepts

| Term | Definition |
|------|------------|
| BoltDB | Embedded key-value database used for storing API request data locally, providing persistence without external dependencies. |
| Entity Conversion | Process of converting between database storage types and domain entities, handled by the repository layer to maintain clean architecture. |
| Request Limiting | Database queries support limit and offset parameters to manage memory usage and optimize network traffic between monitor and server. |
| EmbeddedPlanRepository | Repository implementation that reads plan configuration data from embedded JSON files using go:embed, providing compile-time data inclusion. |
| PlanRepository | Interface defining contract for plan data access, enabling dependency injection and testing through mock implementations. |
| Variable Substitution | Process of replacing format string placeholders (e.g., "@daily_cost") with actual usage values for quick query output formatting. |
| GetUsageVariablesQuery | Unified usecase that retrieves all format variables in a single operation, providing atomic consistency and reducing database round-trips. |